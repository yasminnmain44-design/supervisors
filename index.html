<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù‡Ø¯Ø©</title>
    
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PWA Ù„Ù„ØªØ«Ø¨ÙŠØª -->
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±&quot;,
        &quot;short_name&quot;: &quot;Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†&quot;,
        &quot;description&quot;: &quot;Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„Ø£Ø¹Ø·Ø§Ù„ ÙˆØ§Ù„Ø¹Ù‡Ø¯Ø©&quot;,
        &quot;start_url&quot;: &quot;https://yasminnmain44-design.github.io/supervisors/&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;orientation&quot;: &quot;portrait&quot;,
        &quot;background_color&quot;: &quot;#4361ee&quot;,
        &quot;theme_color&quot;: &quot;#4361ee&quot;,
        &quot;dir&quot;: &quot;rtl&quot;,
        &quot;lang&quot;: &quot;ar&quot;,
        &quot;icons&quot;: [
            {
                &quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%234361ee'/%3E%3Cpath d='M50 20 L70 40 L50 60 L30 40 L50 20' fill='white' opacity='0.9'/%3E%3Ccircle cx='50' cy='55' r='15' fill='white' opacity='0.9'/%3E%3Ctext x='50' y='68' font-size='30' text-anchor='middle' fill='%234361ee' font-weight='bold' font-family='Arial'%3EğŸ‘¤%3C/text%3E%3C/svg%3E&quot;,
                &quot;sizes&quot;: &quot;192x192&quot;,
                &quot;type&quot;: &quot;image/svg+xml&quot;,
                &quot;purpose&quot;: &quot;any maskable&quot;
            },
            {
                &quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%234361ee'/%3E%3Cpath d='M50 20 L70 40 L50 60 L30 40 L50 20' fill='white' opacity='0.9'/%3E%3Ccircle cx='50' cy='55' r='15' fill='white' opacity='0.9'/%3E%3Ctext x='50' y='68' font-size='30' text-anchor='middle' fill='%234361ee' font-weight='bold' font-family='Arial'%3EğŸ‘¤%3C/text%3E%3C/svg%3E&quot;,
                &quot;sizes&quot;: &quot;512x512&quot;,
                &quot;type&quot;: &quot;image/svg+xml&quot;,
                &quot;purpose&quot;: &quot;any maskable&quot;
            }
        ]
    }">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†">
    <meta name="theme-color" content="#4361ee">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #2c3e50;
            --success: #06d6a0;
            --success-dark: #05b586;
            --warning: #ffb703;
            --warning-dark: #faa300;
            --danger: #ef476f;
            --danger-dark: #d63e62;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --whatsapp: #25D366;
            --whatsapp-dark: #128C7E;
            --cash: #f1c40f;
            --cash-dark: #f39c12;
            --negative: #e74c3c;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            direction: rtl;
            padding: 0;
            margin: 0;
        }

        /* Ø±Ø³Ø§Ù„Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .install-prompt {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 20px auto;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            position: fixed;
            bottom: 90px;
            left: 15px;
            right: 15px;
            z-index: 1001;
            border: 1px solid var(--primary);
            animation: slideUp 0.3s ease;
        }

        .install-prompt.show {
            display: block;
        }

        .install-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .install-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .install-text h3 {
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .install-text p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .install-buttons {
            display: flex;
            gap: 10px;
        }

        .install-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .install-btn.primary {
            background: var(--primary);
            color: white;
        }

        .install-btn.secondary {
            background: var(--light);
            color: var(--dark);
        }

        .install-btn.primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .install-btn.secondary:hover {
            background: var(--gray-light);
            transform: translateY(-2px);
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            margin: 20px;
            padding: 40px 25px;
            text-align: center;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            margin-bottom: 30px;
        }

        .login-header i {
            font-size: 70px;
            color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
            padding: 25px;
            border-radius: 50%;
            margin-bottom: 20px;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .login-header h1 {
            color: var(--secondary);
            font-size: 2rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .login-header p {
            color: var(--gray);
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 16px 18px;
            border: 2px solid var(--gray-light);
            border-radius: 16px;
            font-size: 1rem;
            transition: all 0.3s;
            background: var(--light);
            -webkit-appearance: none;
            appearance: none;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15);
            background: white;
        }

        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 15px rgba(67, 97, 238, 0.3);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(67, 97, 238, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            box-shadow: 0 8px 15px rgba(6, 214, 160, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
            box-shadow: 0 8px 15px rgba(255, 183, 3, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            box-shadow: 0 8px 15px rgba(239, 71, 111, 0.3);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, var(--whatsapp) 0%, var(--whatsapp-dark) 100%);
            box-shadow: 0 8px 15px rgba(37, 211, 102, 0.3);
        }

        .btn-cash {
            background: linear-gradient(135deg, var(--cash) 0%, var(--cash-dark) 100%);
            box-shadow: 0 8px 15px rgba(241, 196, 15, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--gray) 0%, #5a6268 100%);
            box-shadow: 0 8px 15px rgba(108, 117, 125, 0.3);
        }

        .error-message {
            background: rgba(239, 71, 111, 0.1);
            color: var(--danger);
            padding: 15px;
            border-radius: 16px;
            margin-top: 20px;
            font-size: 0.95rem;
            display: none;
            border: 1px solid rgba(239, 71, 111, 0.3);
        }

        .error-message i {
            margin-left: 8px;
        }

        /* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .app-container {
            background: #f5f7fa;
            min-height: 100vh;
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
            position: relative;
            display: none;
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± - Ù…ØµØºØ± */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 12px 15px 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(67, 97, 238, 0.3);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1rem;
            font-weight: 600;
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .app-title i {
            font-size: 0.9rem;
            margin-left: 5px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-name {
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(5px);
            font-weight: 500;
        }

        .user-name i {
            font-size: 0.9rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            box-shadow: none;
            padding: 0;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: rotate(90deg);
            box-shadow: none;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 8px 5px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.08);
            z-index: 100;
            max-width: 450px;
            margin: 0 auto;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            font-size: 0.7rem;
            flex: 1;
            padding: 5px 0;
            cursor: pointer;
            border-radius: 15px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-item.active {
            color: var(--primary);
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1) 0%, rgba(67, 97, 238, 0.05) 100%);
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content {
            padding: 15px 12px;
            padding-bottom: 80px;
            overflow-y: auto;
            max-height: calc(100vh - 100px);
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card {
            background: white;
            border-radius: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            margin-bottom: 15px;
            overflow: hidden;
            border: none;
        }

        .card-header {
            padding: 12px 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header i {
            font-size: 1rem;
            margin-left: 6px;
        }

        .card-body {
            padding: 15px;
        }

        /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© - Ù…ØµÙÙˆÙØ© Ù…Ù† Ø¹Ù…ÙˆØ¯ÙŠÙ† */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 10px 6px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.04);
            text-align: center;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.2;
            margin-bottom: 2px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø© - Ù…ØµÙÙˆÙØ© Ù…Ù† 3 Ø£Ø¹Ù…Ø¯Ø© */
        .cash-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }

        .cash-stat-card {
            background: white;
            border-radius: 12px;
            padding: 8px 4px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.04);
            text-align: center;
            border: none;
            border-top: 3px solid var(--cash);
        }

        .cash-stat-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--cash-dark);
            line-height: 1.2;
            margin: 2px 0;
        }

        .cash-stat-value.negative {
            color: var(--negative);
        }

        .cash-stat-label {
            color: var(--gray);
            font-size: 0.65rem;
            font-weight: 500;
        }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø© */
        .cash-tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-light);
            margin-bottom: 15px;
            overflow-x: auto;
        }

        .cash-tab {
            flex: 1;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .cash-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .cash-tab-content {
            display: none;
        }

        .cash-tab-content.active {
            display: block;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.3s;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:hover {
            background: rgba(67, 97, 238, 0.02);
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
            color: var(--dark);
        }

        .item-subtitle {
            color: var(--gray);
            font-size: 0.8rem;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .empty-state {
            text-align: center;
            color: var(--gray);
            padding: 30px 15px;
            font-style: normal;
            background: var(--light);
            border-radius: 16px;
        }

        .empty-state i {
            font-size: 2.5rem;
            color: var(--gray-light);
            margin-bottom: 10px;
            display: block;
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ± */
        .status-present {
            color: var(--success);
            font-weight: 600;
            background: rgba(6, 214, 160, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .status-absent {
            color: var(--danger);
            font-weight: 600;
            background: rgba(239, 71, 111, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .status-leave {
            color: var(--warning);
            font-weight: 600;
            background: rgba(255, 183, 3, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‡Ø¯Ø© */
        .cash-positive {
            color: var(--success);
            font-weight: 600;
            background: rgba(6, 214, 160, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .cash-negative {
            color: var(--negative);
            font-weight: 600;
            background: rgba(231, 76, 60, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Ø§Ù„ÙÙ„Ø§ØªØ± */
        .filter-section {
            background: var(--light);
            padding: 12px;
            border-radius: 14px;
            margin-bottom: 12px;
            border: none;
        }

        .filter-section .form-group {
            margin-bottom: 0;
        }

        /* Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø·Ø© */
        .station-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            font-weight: 500;
        }

        /* Ø´Ø§Ø±Ø© ÙˆØ§ØªØ³Ø§Ø¨ */
        .whatsapp-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            background: rgba(37, 211, 102, 0.1);
            color: var(--whatsapp-dark);
            font-weight: 500;
            margin-bottom: 12px;
        }

        .whatsapp-badge i {
            color: var(--whatsapp);
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
        .connection-status {
            position: fixed;
            top: 60px;
            left: 15px;
            right: 15px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            z-index: 1000;
            color: white;
            display: none;
            text-align: center;
            font-weight: 500;
            max-width: 400px;
            margin: 0 auto;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            backdrop-filter: blur(5px);
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            padding: 12px 15px;
            border-radius: 14px;
            margin-bottom: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert i {
            font-size: 1.1rem;
        }

        .alert-success {
            background: rgba(6, 214, 160, 0.1);
            color: var(--success);
            border: 1px solid rgba(6, 214, 160, 0.3);
        }

        .alert-error {
            background: rgba(239, 71, 111, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 71, 111, 0.3);
        }

        .alert-warning {
            background: rgba(255, 183, 3, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 183, 3, 0.3);
        }

        .alert-info {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        @media (max-width: 350px) {
            .cash-stats {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .quick-stats {
                gap: 5px;
            }
            
            .stat-value {
                font-size: 1.2rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .app-title {
                font-size: 0.9rem;
                padding: 5px 10px;
            }
            
            .user-name {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .nav-icon {
                font-size: 1.1rem;
            }
            
            .nav-item {
                font-size: 0.6rem;
            }
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        .welcome-message {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05) 0%, rgba(67, 97, 238, 0.02) 100%);
            padding: 12px;
            border-radius: 14px;
            margin-bottom: 12px;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .welcome-message h3 {
            color: var(--primary);
            margin-bottom: 2px;
            font-size: 1rem;
        }

        .welcome-message p {
            color: var(--gray);
            font-size: 0.85rem;
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ¨ÙŠØ± */
        .loading-large {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 250px;
        }

        .loading-large .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        /* Ø§Ù„ÙÙ„Ø§ØªØ± Ù…Ø¹ Ø²Ø± */
        .filter-with-button {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .filter-with-button .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .filter-with-button button {
            width: auto;
            padding: 14px 16px;
            height: 48px;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        /* Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù‡Ø¯Ø© */
        .cash-summary {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1) 0%, rgba(243, 156, 18, 0.05) 100%);
            border-radius: 14px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .cash-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(241, 196, 15, 0.2);
            font-size: 0.85rem;
        }

        .cash-summary-item:last-child {
            border-bottom: none;
        }

        .cash-summary-label {
            font-weight: 500;
            color: var(--gray);
        }

        .cash-summary-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--cash-dark);
        }

        .cash-summary-value.negative {
            color: var(--negative);
        }
    </style>
</head>
<body>
    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-header">
            <div class="install-icon">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="install-text">
                <h3>ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                <p>Ù‚Ù… Ø¨ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø´Ø§Ø´ØªÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹</p>
            </div>
        </div>
        <div class="install-buttons">
            <button class="install-btn primary" id="installApp">ØªØ«Ø¨ÙŠØª</button>
            <button class="install-btn secondary" id="closeInstall">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="login-container" id="loginScreen">
        <div class="login-header">
            <i class="fas fa-user-shield"></i>
            <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
            <p>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¹Ù‡Ø¯Ø©</p>
        </div>
        
        <form id="loginForm">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                <select id="supervisorName" required>
                    <option value="">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</option>
                </select>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                <input type="password" id="supervisorPassword" required placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ">
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="rememberMe" style="width: auto; margin-left: 10px;" checked>
                <label for="rememberMe" style="display: inline; margin: 0;">ØªØ°ÙƒØ±Ù†ÙŠ (Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ù…ØªØµÙ„Ø§Ù‹)</label>
            </div>
            
            <button type="submit" id="loginButton">
                <span id="loginBtnText">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            </button>
        </form>
        
        <div class="error-message" id="loginError">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText">Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</span>
        </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="app-container" id="appContainer">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title" id="pageTitle">
                    <i class="fas fa-home"></i>
                    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </div>
                <div class="user-info">
                    <div class="user-name" id="currentUserDisplay">
                        <i class="fas fa-user-circle"></i>
                        <span id="currentUserName"></span>
                    </div>
                    <button class="logout-btn" id="logoutBtn" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <div class="connection-status" id="connectionStatus">
            <i class="fas fa-wifi"></i> Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <main class="main-content" id="mainContent">
            <!-- Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </main>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <nav class="bottom-nav" id="bottomNav">
            <div class="nav-item active" data-page="dashboard">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-text">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            </div>
            <div class="nav-item" data-page="attendance">
                <div class="nav-icon"><i class="fas fa-user-check"></i></div>
                <div class="nav-text">Ø§Ù„Ø­Ø¶ÙˆØ±</div>
            </div>
            <div class="nav-item" data-page="leaves">
                <div class="nav-icon"><i class="fas fa-umbrella-beach"></i></div>
                <div class="nav-text">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</div>
            </div>
            <div class="nav-item" data-page="faults">
                <div class="nav-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="nav-text">Ø§Ù„Ø£Ø¹Ø·Ø§Ù„</div>
            </div>
            <div class="nav-item" data-page="financial">
                <div class="nav-icon"><i class="fas fa-hand-holding-usd"></i></div>
                <div class="nav-text">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
            </div>
            <div class="nav-item" data-page="cash">
                <div class="nav-icon"><i class="fas fa-wallet"></i></div>
                <div class="nav-text">Ø§Ù„Ø¹Ù‡Ø¯Ø©</div>
            </div>
        </nav>
    </div>

    <script>
        // Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ØµÙŠØ§Ù†Ø© (ÙˆØ§ØªØ³Ø§Ø¨)
        const MANAGER_PHONE = "201555153901"; // Ø¨Ø¯ÙˆÙ† + ÙˆØ¨Ø¯ÙˆÙ† ØµÙØ± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
        const MANAGER_DISPLAY_PHONE = "+20 15 55153901";

        // ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const firebaseConfig = {
            apiKey: "AIzaSyDjImFc52SF5TlN7k7vz0H6-8bWl8Pkz0k",
            authDomain: "haat-a88ee.firebaseapp.com",
            databaseURL: "https://haat-a88ee-default-rtdb.firebaseio.com",
            projectId: "haat-a88ee",
            storageBucket: "haat-a88ee.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let currentSupervisor = null;
        let supervisors = [];
        let employees = [];
        let stations = [];
        let attendance = [];
        let leaves = [];
        let faults = [];
        let financials = [];
        let cashTransactions = []; // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø©
        let isConnected = false;
        let autoRefreshInterval = null;

        // Ù…ØªØºÙŠØ±Ø§Øª PWA
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installAppBtn = document.getElementById('installApp');
        const closeInstallBtn = document.getElementById('closeInstall');

        // Ø¹Ù†Ø§ØµØ± DOM
        const loginScreen = document.getElementById('loginScreen');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const supervisorSelect = document.getElementById('supervisorName');
        const supervisorPassword = document.getElementById('supervisorPassword');
        const loginError = document.getElementById('loginError');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginButton = document.getElementById('loginButton');
        const currentUserName = document.getElementById('currentUserName');
        const logoutBtn = document.getElementById('logoutBtn');
        const bottomNav = document.getElementById('bottomNav');
        const mainContent = document.getElementById('mainContent');
        const pageTitle = document.getElementById('pageTitle');
        const connectionStatus = document.getElementById('connectionStatus');
        const rememberMeCheckbox = document.getElementById('rememberMe');

        // ==================== ÙƒÙˆØ¯ PWA Ù„Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====================

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨ØªØ§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true ||
                   document.referrer.includes('android-app://');
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…Ø«Ø¨Øª ÙˆØ§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨ØªØ§Ù‹
            if (!isAppInstalled() && !localStorage.getItem('installPromptClosed')) {
                setTimeout(() => {
                    installPrompt.classList.add('show');
                }, 3000);
            }
        });

        // ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        installAppBtn.addEventListener('click', async () => {
            if (!deferredPrompt) {
                showTemporaryMessage('Ø§Ù„ØªØ«Ø¨ÙŠØª ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹', 'error');
                return;
            }
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
                installPrompt.classList.remove('show');
                localStorage.setItem('appInstalled', 'true');
                showTemporaryMessage('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'success');
            }
            
            deferredPrompt = null;
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª
        closeInstallBtn.addEventListener('click', () => {
            installPrompt.classList.remove('show');
            localStorage.setItem('installPromptClosed', 'true');
        });

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
        document.addEventListener('DOMContentLoaded', () => {
            if (!isAppInstalled() && !localStorage.getItem('installPromptClosed') && !localStorage.getItem('appInstalled')) {
                // Ø§Ù†ØªØ¸Ø± 3 Ø«ÙˆØ§Ù†ÙŠ Ø«Ù… Ø£Ø¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                setTimeout(() => {
                    if (deferredPrompt) {
                        installPrompt.classList.add('show');
                    }
                }, 3000);
            }
            
            loadSupervisors();
            checkSavedSession();
            startAutoDateRefresh();
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªØ§Ø±ÙŠØ®
        function startAutoDateRefresh() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
            autoRefreshInterval = setInterval(() => {
                if (appContainer.style.display === 'block' && currentSupervisor) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©
                    updateDatesInCurrentPage();
                }
            }, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function updateDatesInCurrentPage() {
            const today = getTodayDate();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            const attendanceDate = document.getElementById('attendanceDate');
            if (attendanceDate && attendanceDate.value !== today) {
                attendanceDate.value = today;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ ÙÙ„ØªØ± Ø§Ù„Ø­Ø¶ÙˆØ±
            const filterAttendanceDate = document.getElementById('filterAttendanceDate');
            if (filterAttendanceDate && filterAttendanceDate.value !== today) {
                filterAttendanceDate.value = today;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„
            const faultDate = document.getElementById('faultDate');
            if (faultDate && faultDate.value !== today) {
                faultDate.value = today;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
            const leaveStart = document.getElementById('leaveStart');
            if (leaveStart && leaveStart.value !== today) {
                leaveStart.value = today;
            }
            
            const leaveEnd = document.getElementById('leaveEnd');
            if (leaveEnd && leaveEnd.value !== today) {
                leaveEnd.value = today;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            const financialDate = document.getElementById('financialDate');
            if (financialDate && financialDate.value !== today) {
                financialDate.value = today;
            }
            
            const filterFinancialDate = document.getElementById('filterFinancialDate');
            if (filterFinancialDate && filterFinancialDate.value !== today) {
                filterFinancialDate.value = today;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¹Ù‡Ø¯Ø©
            const cashDate = document.getElementById('cashDate');
            if (cashDate && cashDate.value !== today) {
                cashDate.value = today;
            }
            
            const cashWithdrawalDate = document.getElementById('cashWithdrawalDate');
            if (cashWithdrawalDate && cashWithdrawalDate.value !== today) {
                cashWithdrawalDate.value = today;
            }
            
            const filterCashDate = document.getElementById('filterCashDate');
            if (filterCashDate && filterCashDate.value !== today) {
                filterCashDate.value = today;
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø¨ØµÙŠØºØ© YYYY-MM-DD
        function getTodayDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø©
        function checkSavedSession() {
            const savedSession = localStorage.getItem('attendance_supervisor_session');
            
            if (savedSession) {
                try {
                    const sessionData = JSON.parse(savedSession);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù… ØªÙ†ØªÙ‡ (ØµÙ„Ø§Ø­ÙŠØ© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©)
                    if (sessionData.supervisorId && sessionData.supervisorName) {
                        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                        showLoading(true);
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹
                        database.ref('supervisors').once('value')
                            .then((snapshot) => {
                                const data = snapshot.val();
                                if (data) {
                                    supervisors = Object.keys(data).map(key => {
                                        return { id: key, ...data[key] };
                                    });
                                    
                                    const supervisor = supervisors.find(s => s.id === sessionData.supervisorId);
                                    
                                    if (supervisor && supervisor.active) {
                                        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
                                        currentSupervisor = supervisor;
                                        currentUserName.textContent = supervisor.employeeName;
                                        
                                        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                                        loginScreen.style.display = 'none';
                                        appContainer.style.display = 'block';
                                        
                                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                        loadAllData();
                                        
                                        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
                                        showTemporaryMessage(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ${supervisor.employeeName}`, 'success');
                                    } else {
                                        // Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØºÙŠØ± Ù†Ø´Ø·
                                        localStorage.removeItem('attendance_supervisor_session');
                                        showLoading(false);
                                    }
                                } else {
                                    localStorage.removeItem('attendance_supervisor_session');
                                    showLoading(false);
                                }
                            })
                            .catch(error => {
                                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©:', error);
                                localStorage.removeItem('attendance_supervisor_session');
                                showLoading(false);
                            });
                    } else {
                        showLoading(false);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©:', error);
                    localStorage.removeItem('attendance_supervisor_session');
                    showLoading(false);
                }
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
        function saveSession(supervisor, remember = true) {
            if (remember) {
                const sessionData = {
                    supervisorId: supervisor.id,
                    supervisorName: supervisor.employeeName,
                    loginTime: new Date().toISOString()
                };
                localStorage.setItem('attendance_supervisor_session', JSON.stringify(sessionData));
            } else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… sessionStorage Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† localStorage (ÙŠÙ†ØªÙ‡ÙŠ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­)
                const sessionData = {
                    supervisorId: supervisor.id,
                    supervisorName: supervisor.employeeName,
                    loginTime: new Date().toISOString()
                };
                sessionStorage.setItem('attendance_supervisor_session', JSON.stringify(sessionData));
            }
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        function monitorConnection() {
            const connectedRef = firebase.database().ref(".info/connected");
            connectedRef.on("value", function(snap) {
                isConnected = snap.val() === true;
                if (isConnected) {
                    showConnectionStatus('Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
                } else {
                    showConnectionStatus('ØºÙŠØ± Ù…ØªØµÙ„ - ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
                }
            });
        }

        function showConnectionStatus(message, type) {
            connectionStatus.style.display = 'block';
            connectionStatus.style.background = type === 'success' ? 
                'linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%)' : 
                'linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%)';
            connectionStatus.innerHTML = `<i class="fas fa-${type === 'success' ? 'wifi' : 'wifi-slash'}"></i> ${message}`;
            
            if (type === 'success') {
                setTimeout(() => {
                    connectionStatus.style.display = 'none';
                }, 3000);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ù…Ù† Firebase
        function loadSupervisors() {
            database.ref('supervisors').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        supervisors = Object.keys(data).map(key => {
                            return { id: key, ...data[key] };
                        });
                    }
                    populateSupervisorSelect();
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†:', error);
                    showLoginError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†');
                });
        }

        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        function populateSupervisorSelect() {
            supervisorSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</option>';
            
            const activeSupervisors = supervisors.filter(sup => sup.active);
            
            if (activeSupervisors.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†';
                option.disabled = true;
                supervisorSelect.appendChild(option);
                return;
            }
            
            activeSupervisors.sort((a, b) => a.employeeName.localeCompare(b.employeeName));
            
            activeSupervisors.forEach(sup => {
                const option = document.createElement('option');
                option.value = sup.id;
                option.textContent = sup.employeeName;
                supervisorSelect.appendChild(option);
            });
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const supervisorId = supervisorSelect.value;
            const password = supervisorPassword.value;
            const rememberMe = rememberMeCheckbox.checked;
            
            if (!supervisorId || !password) {
                showLoginError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙˆØ¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±');
                return;
            }
            
            const supervisor = supervisors.find(s => s.id === supervisorId);
            
            if (supervisor && supervisor.password === password) {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­
                currentSupervisor = supervisor;
                currentUserName.textContent = supervisor.employeeName;
                
                // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
                saveSession(supervisor, rememberMe);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                loginScreen.style.display = 'none';
                appContainer.style.display = 'block';
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
                loadAllData();
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
                showTemporaryMessage(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${supervisor.employeeName}`, 'success');
            } else {
                showLoginError('Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        });

        // Ø¥Ø¸Ù‡Ø§Ø± Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function showLoginError(message) {
            document.getElementById('errorText').textContent = message;
            loginError.style.display = 'block';
            loginButton.style.animation = 'shake 0.5s ease';
            
            setTimeout(() => {
                loginError.style.display = 'none';
                loginButton.style.animation = '';
            }, 3000);
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        logoutBtn.addEventListener('click', function() {
            // Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®Ø²ÙŠÙ†Ø§Øª
            localStorage.removeItem('attendance_supervisor_session');
            sessionStorage.removeItem('attendance_supervisor_session');
            
            currentSupervisor = null;
            appContainer.style.display = 'none';
            loginScreen.style.display = 'flex';
            loginScreen.style.flexDirection = 'column';
            loginScreen.style.justifyContent = 'center';
            supervisorSelect.value = '';
            supervisorPassword.value = '';
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });

        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø·
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
                // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
                showPage(page);
            });
        });

        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function showPage(page) {
            const titles = {
                'dashboard': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
                'attendance': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±',
                'leaves': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª',
                'faults': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„',
                'financial': 'Ø§Ù„Ø³Ù„Ù ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª',
                'cash': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‡Ø¯Ø©'
            };
            
            pageTitle.innerHTML = `<i class="fas fa-${getIconForPage(page)}"></i> <span>${titles[page]}</span>`;
            
            switch(page) {
                case 'dashboard':
                    showDashboard();
                    break;
                case 'attendance':
                    showAttendancePage();
                    break;
                case 'leaves':
                    showLeavesPage();
                    break;
                case 'faults':
                    showFaultsPage();
                    break;
                case 'financial':
                    showFinancialPage();
                    break;
                case 'cash':
                    showCashPage();
                    break;
            }
        }

        function getIconForPage(page) {
            const icons = {
                'dashboard': 'home',
                'attendance': 'user-check',
                'leaves': 'umbrella-beach',
                'faults': 'exclamation-triangle',
                'financial': 'hand-holding-usd',
                'cash': 'wallet'
            };
            return icons[page];
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function loadAllData() {
            showLoading(true);
            
            Promise.all([
                loadData('employees'),
                loadData('stations'),
                loadData('attendance'),
                loadData('leaves'),
                loadData('faults'),
                loadData('financials'),
                loadData('cashTransactions') // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø©
            ]).then(() => {
                showLoading(false);
                showDashboard();
                showConnectionStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }).catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showLoading(false);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
        function loadData(dataType) {
            return new Promise((resolve, reject) => {
                database.ref(dataType).once('value')
                    .then((snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const dataArray = Object.keys(data).map(key => {
                                return { id: key, ...data[key] };
                            });
                            
                            if (dataType === 'employees') employees = dataArray;
                            else if (dataType === 'stations') stations = dataArray;
                            else if (dataType === 'attendance') attendance = dataArray;
                            else if (dataType === 'leaves') leaves = dataArray;
                            else if (dataType === 'faults') faults = dataArray;
                            else if (dataType === 'financials') financials = dataArray;
                            else if (dataType === 'cashTransactions') cashTransactions = dataArray;
                        } else {
                            if (dataType === 'employees') employees = [];
                            else if (dataType === 'stations') stations = [];
                            else if (dataType === 'attendance') attendance = [];
                            else if (dataType === 'leaves') leaves = [];
                            else if (dataType === 'faults') faults = [];
                            else if (dataType === 'financials') financials = [];
                            else if (dataType === 'cashTransactions') cashTransactions = [];
                        }
                        resolve();
                    })
                    .catch(error => {
                        console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ${dataType}:`, error);
                        reject(error);
                    });
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Firebase
        function addData(dataType, newItem) {
            return new Promise((resolve, reject) => {
                const newId = Date.now().toString() + Math.random().toString(36).substr(2, 5);
                
                database.ref(`${dataType}/${newId}`).set(newItem)
                    .then(() => {
                        const itemWithId = { id: newId, ...newItem };
                        
                        if (dataType === 'attendance') attendance.push(itemWithId);
                        else if (dataType === 'leaves') leaves.push(itemWithId);
                        else if (dataType === 'faults') faults.push(itemWithId);
                        else if (dataType === 'financials') financials.push(itemWithId);
                        else if (dataType === 'cashTransactions') cashTransactions.push(itemWithId);
                        
                        resolve(itemWithId);
                    })
                    .catch(error => {
                        console.error(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ${dataType}:`, error);
                        reject(error);
                    });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase
        function updateData(dataType, id, updatedData) {
            return new Promise((resolve, reject) => {
                database.ref(`${dataType}/${id}`).update(updatedData)
                    .then(() => {
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                        if (dataType === 'attendance') {
                            const index = attendance.findIndex(item => item.id === id);
                            if (index !== -1) attendance[index] = { ...attendance[index], ...updatedData };
                        } else if (dataType === 'leaves') {
                            const index = leaves.findIndex(item => item.id === id);
                            if (index !== -1) leaves[index] = { ...leaves[index], ...updatedData };
                        } else if (dataType === 'faults') {
                            const index = faults.findIndex(item => item.id === id);
                            if (index !== -1) faults[index] = { ...faults[index], ...updatedData };
                        } else if (dataType === 'financials') {
                            const index = financials.findIndex(item => item.id === id);
                            if (index !== -1) financials[index] = { ...financials[index], ...updatedData };
                        } else if (dataType === 'cashTransactions') {
                            const index = cashTransactions.findIndex(item => item.id === id);
                            if (index !== -1) cashTransactions[index] = { ...cashTransactions[index], ...updatedData };
                        }
                        
                        resolve();
                    })
                    .catch(error => {
                        console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« ${dataType}:`, error);
                        reject(error);
                    });
            });
        }

        // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
        function deleteData(dataType, id) {
            return new Promise((resolve, reject) => {
                database.ref(`${dataType}/${id}`).remove()
                    .then(() => {
                        if (dataType === 'attendance') attendance = attendance.filter(item => item.id !== id);
                        else if (dataType === 'leaves') leaves = leaves.filter(item => item.id !== id);
                        else if (dataType === 'faults') faults = faults.filter(item => item.id !== id);
                        else if (dataType === 'financials') financials = financials.filter(item => item.id !== id);
                        else if (dataType === 'cashTransactions') cashTransactions = cashTransactions.filter(item => item.id !== id);
                        
                        resolve();
                    })
                    .catch(error => {
                        console.error(`Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù ${dataType}:`, error);
                        reject(error);
                    });
            });
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø¹Ø·Ù„ Ø¬Ø¯ÙŠØ¯
        function sendFaultNotificationToManager(faultData) {
            try {
                // ØªÙƒÙˆÙŠÙ† Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                const message = `ğŸš¨ *ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø·Ù„ Ø¬Ø¯ÙŠØ¯* ğŸš¨
                
ğŸ”§ *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${faultData.title}
ğŸ“ *Ø§Ù„Ù…Ø­Ø·Ø©:* ${faultData.stationName}
ğŸ“ *Ø§Ù„ØªÙØ§ØµÙŠÙ„:* ${faultData.description}
ğŸ“… *Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${faultData.date}
ğŸ‘¤ *Ø§Ù„Ù…Ø³Ø¬Ù„:* ${faultData.supervisorName}
â° *Ø§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleTimeString('ar-EG')}

ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„.`;

                // ØªØ±Ù…ÙŠØ² Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
                const encodedMessage = encodeURIComponent(message);
                
                // Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ (Ø¨Ø¯ÙˆÙ† + ÙˆØ¨Ø¯ÙˆÙ† ØµÙØ± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)
                const whatsappUrl = `https://wa.me/${MANAGER_PHONE}?text=${encodedMessage}`;
                
                // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                window.open(whatsappUrl, '_blank');
                
                console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨');
                return true;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨:', error);
                return false;
            }
        }

        // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoading(show) {
            if (show) {
                mainContent.innerHTML = `
                    <div class="loading-large">
                        <div class="spinner"></div>
                        <p style="color: var(--gray); font-size: 1.1rem;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
                    </div>
                `;
            }
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
        function showError(message) {
            mainContent.innerHTML = `
                <div class="alert alert-error" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                    <p style="margin-bottom: 20px; font-size: 1.1rem;">${message}</p>
                    <button onclick="loadAllData()" style="width: auto; padding: 15px 30px; margin: 0 auto;">
                        <i class="fas fa-sync-alt"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                    </button>
                </div>
            `;
        }

        // ==================== ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ====================
        function showDashboard() {
            const today = getTodayDate();
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
            const todayAttendance = attendance.filter(a => a.date === today && a.supervisorId === currentSupervisor.id);
            const todayLeaves = leaves.filter(l => l.start <= today && l.end >= today && l.supervisorId === currentSupervisor.id);
            const pendingFaults = faults.filter(f => f.status !== 'fixed' && f.supervisorId === currentSupervisor.id);
            const todayFinancials = financials.filter(f => f.date === today && f.supervisorId === currentSupervisor.id);
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø©
            const cashBalance = calculateCashBalance();
            const balanceClass = cashBalance < 0 ? 'negative' : '';
            
            mainContent.innerHTML = `
                <div class="welcome-message">
                    <h3><i class="fas fa-sun"></i> Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentSupervisor.employeeName}</h3>
                    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…: ${new Date().toLocaleDateString('ar-EG')}</p>
                </div>
                
                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-value">${todayAttendance.length}</div>
                        <div class="stat-label">ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${todayLeaves.length}</div>
                        <div class="stat-label">Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${pendingFaults.length}</div>
                        <div class="stat-label">Ø£Ø¹Ø·Ø§Ù„ Ù†Ø´Ø·Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${todayFinancials.length}</div>
                        <div class="stat-label">Ø­Ø±ÙƒØ§Øª Ù…Ø§Ù„ÙŠØ©</div>
                    </div>
                </div>
                
                <div class="cash-stats">
                    <div class="cash-stat-card">
                        <div class="cash-stat-label">Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ù‡Ø¯Ø©</div>
                        <div class="cash-stat-value ${balanceClass}">${cashBalance}</div>
                    </div>
                    <div class="cash-stat-card">
                        <div class="cash-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</div>
                        <div class="cash-stat-value">${calculateTotalDeposits()}</div>
                    </div>
                    <div class="cash-stat-card">
                        <div class="cash-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                        <div class="cash-stat-value">${calculateTotalWithdrawals()}</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-clock"></i> Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
                    </div>
                    <div class="card-body">
                        ${displayRecentAttendance()}
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù†Ø´Ø·Ø©
                    </div>
                    <div class="card-body">
                        ${displayActiveFaults()}
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-wallet"></i> Ø¢Ø®Ø± Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø©
                    </div>
                    <div class="card-body">
                        ${displayRecentCashTransactions()}
                    </div>
                </div>
            `;
        }

        function displayRecentAttendance() {
            const recent = attendance
                .filter(a => a.supervisorId === currentSupervisor.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recent.length === 0) {
                return '<div class="empty-state"><i class="fas fa-calendar-times"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø­Ø¯ÙŠØ«Ø©</div>';
            }
            
            let html = '';
            recent.forEach(record => {
                const statusClass = record.status === 'Ø­Ø§Ø¶Ø±' ? 'status-present' : 
                                   record.status === 'ØºØ§Ø¦Ø¨' ? 'status-absent' : 'status-leave';
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${record.employeeName}</div>
                            <div class="item-subtitle">
                                <span class="station-badge">${record.stationName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                <span>${record.date}</span>
                            </div>
                        </div>
                        <div class="${statusClass}">${record.status}</div>
                    </div>
                `;
            });
            return html;
        }

        function displayActiveFaults() {
            const active = faults
                .filter(f => f.status !== 'fixed' && f.supervisorId === currentSupervisor.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (active.length === 0) {
                return '<div class="empty-state"><i class="fas fa-check-circle"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ø·Ø§Ù„ Ù†Ø´Ø·Ø©</div>';
            }
            
            let html = '';
            active.forEach(fault => {
                const statusClass = fault.status === 'in-progress' ? 'status-leave' : 'status-absent';
                const statusText = fault.status === 'in-progress' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­';
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${fault.title}</div>
                            <div class="item-subtitle">
                                <span class="station-badge">${fault.stationName}</span>
                                <span class="${statusClass}">${statusText}</span>
                            </div>
                            <div class="item-subtitle">${fault.date}</div>
                        </div>
                    </div>
                `;
            });
            return html;
        }

        function displayRecentCashTransactions() {
            const recent = cashTransactions
                .filter(c => c.supervisorId === currentSupervisor.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recent.length === 0) {
                return '<div class="empty-state"><i class="fas fa-coins"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ø¹Ù‡Ø¯Ø© Ø­Ø¯ÙŠØ«Ø©</div>';
            }
            
            let html = '';
            recent.forEach(transaction => {
                const amountClass = transaction.type === 'Ø¥ÙŠØ¯Ø§Ø¹' ? 'cash-positive' : 'cash-negative';
                const amountSign = transaction.type === 'Ø¥ÙŠØ¯Ø§Ø¹' ? '+' : '-';
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${transaction.reason}</div>
                            <div class="item-subtitle">
                                <span>${transaction.date}</span>
                                <span>${transaction.type}</span>
                                ${transaction.stationName ? `<span class="station-badge">${transaction.stationName}</span>` : ''}
                            </div>
                        </div>
                        <div class="${amountClass}">${amountSign} ${transaction.amount} Ø¬.Ù…</div>
                    </div>
                `;
            });
            return html;
        }

        // Ø­Ø³Ø§Ø¨ Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ù‡Ø¯Ø©
        function calculateCashBalance() {
            let balance = 0;
            cashTransactions.forEach(transaction => {
                if (transaction.type === 'Ø¥ÙŠØ¯Ø§Ø¹') {
                    balance += transaction.amount;
                } else if (transaction.type === 'ØµØ±Ù') {
                    balance -= transaction.amount;
                }
            });
            return balance;
        }

        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª
        function calculateTotalDeposits() {
            return cashTransactions
                .filter(t => t.type === 'Ø¥ÙŠØ¯Ø§Ø¹')
                .reduce((sum, t) => sum + t.amount, 0);
        }

        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
        function calculateTotalWithdrawals() {
            return cashTransactions
                .filter(t => t.type === 'ØµØ±Ù')
                .reduce((sum, t) => sum + t.amount, 0);
        }

        // ==================== ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ====================
        function showAttendancePage() {
            const today = getTodayDate();
            
            mainContent.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-user-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨
                    </div>
                    <div class="card-body">
                        <form id="attendanceForm">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                <select id="attendanceEmployee" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù</option>
                                    ${getEmployeesOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-building"></i> Ø§Ù„Ù…Ø­Ø·Ø©</label>
                                <select id="attendanceStation" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø©</option>
                                    ${getStationsOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="attendanceDate" value="${today}" min="${today}" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tag"></i> Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <select id="attendanceStatus" required>
                                    <option value="Ø­Ø§Ø¶Ø±">âœ… Ø­Ø§Ø¶Ø± (Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø­Ø·Ø©)</option>
                                    <option value="ØºØ§Ø¦Ø¨">âŒ ØºØ§Ø¦Ø¨ (ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯)</option>
                                    <option value="Ø¥Ø¬Ø§Ø²Ø©">ğŸ–ï¸ Ø¥Ø¬Ø§Ø²Ø©</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn-success">
                                <span id="attendanceSubmitText"><i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</span>
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-history"></i> Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„Ø§ØªÙŠ
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="form-group">
                                <label><i class="fas fa-filter"></i> ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="filterAttendanceDate" value="${today}" min="${today}">
                            </div>
                        </div>
                        <div id="myAttendanceList">
                            ${displayMyAttendance(today)}
                        </div>
                    </div>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('attendanceForm').addEventListener('submit', recordAttendance);
            document.getElementById('filterAttendanceDate').addEventListener('change', function() {
                document.getElementById('myAttendanceList').innerHTML = displayMyAttendance(this.value);
            });
        }

        function getEmployeesOptions() {
            const activeEmployees = employees.filter(emp => emp.active);
            if (activeEmployees.length === 0) {
                return '<option value="" disabled>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</option>';
            }
            return activeEmployees.map(emp => 
                `<option value="${emp.name}">${emp.name}</option>`
            ).join('');
        }

        function getStationsOptions() {
            if (stations.length === 0) {
                return '<option value="" disabled>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø·Ø§Øª Ù…Ø³Ø¬Ù„Ø©</option>';
            }
            return stations.map(station => 
                `<option value="${station.name}">${station.name}</option>`
            ).join('');
        }

        function recordAttendance(e) {
            e.preventDefault();
            
            const employeeName = document.getElementById('attendanceEmployee').value;
            const stationName = document.getElementById('attendanceStation').value;
            const date = document.getElementById('attendanceDate').value;
            const status = document.getElementById('attendanceStatus').value;
            
            if (!employeeName || !stationName || !date || !status) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            const existingRecord = attendance.find(record => 
                record.employeeName === employeeName && record.date === date
            );
            
            const submitBtn = document.getElementById('attendanceSubmitText');
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const newAttendance = {
                employeeName,
                stationName,
                supervisorId: currentSupervisor.id,
                supervisorName: currentSupervisor.employeeName,
                date,
                status,
                timestamp: new Date().toISOString()
            };
            
            let promise;
            
            if (existingRecord) {
                promise = updateData('attendance', existingRecord.id, newAttendance);
            } else {
                promise = addData('attendance', newAttendance);
            }
            
            promise.then(() => {
                submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                document.getElementById('attendanceForm').reset();
                document.getElementById('attendanceDate').value = getTodayDate();
                
                setTimeout(() => {
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±';
                }, 2000);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                const filterDate = document.getElementById('filterAttendanceDate').value;
                document.getElementById('myAttendanceList').innerHTML = displayMyAttendance(filterDate);
                
                showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }).catch(error => {
                submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                console.error(error);
                showTemporaryMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
            });
        }

        function displayMyAttendance(date) {
            const myAttendance = attendance
                .filter(a => a.supervisorId === currentSupervisor.id && a.date === date)
                .sort((a, b) => a.employeeName.localeCompare(b.employeeName));
            
            if (myAttendance.length === 0) {
                return '<div class="empty-state"><i class="fas fa-calendar-times"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</div>';
            }
            
            let html = '';
            myAttendance.forEach(record => {
                const statusClass = record.status === 'Ø­Ø§Ø¶Ø±' ? 'status-present' : 
                                   record.status === 'ØºØ§Ø¦Ø¨' ? 'status-absent' : 'status-leave';
                const statusIcon = record.status === 'Ø­Ø§Ø¶Ø±' ? 'âœ…' : 
                                  record.status === 'ØºØ§Ø¦Ø¨' ? 'âŒ' : 'ğŸ–ï¸';
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${record.employeeName}</div>
                            <div class="item-subtitle">
                                <span class="station-badge">${record.stationName}</span>
                            </div>
                        </div>
                        <div class="${statusClass}">${statusIcon} ${record.status}</div>
                    </div>
                `;
            });
            return html;
        }

        // ==================== ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª ====================
        function showLeavesPage() {
            const today = getTodayDate();
            
            mainContent.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-umbrella-beach"></i> ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø²Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </div>
                    <div class="card-body">
                        <form id="leaveForm">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                <select id="leaveEmployee" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù</option>
                                    ${getEmployeesOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-building"></i> Ø§Ù„Ù…Ø­Ø·Ø©</label>
                                <select id="leaveStation" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø©</option>
                                    ${getStationsOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tag"></i> Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</label>
                                <select id="leaveType" required>
                                    <option value="Ø³Ù†ÙˆÙŠØ©">ğŸ“… Ø³Ù†ÙˆÙŠØ©</option>
                                    <option value="Ù…Ø±Ø¶ÙŠØ©">ğŸ¥ Ù…Ø±Ø¶ÙŠØ©</option>
                                    <option value="Ø·Ø§Ø±Ø¦Ø©">âš¡ Ø·Ø§Ø±Ø¦Ø©</option>
                                    <option value="Ø£Ø®Ø±Ù‰">ğŸ”„ Ø£Ø®Ø±Ù‰</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar-start"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                                <input type="date" id="leaveStart" value="${today}" min="${today}" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar-end"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                                <input type="date" id="leaveEnd" value="${today}" min="${today}" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                <textarea id="leaveNotes" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                            </div>
                            
                            <button type="submit" class="btn-warning">
                                <span id="leaveSubmitText"><i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</span>
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list"></i> Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
                    </div>
                    <div class="card-body" id="activeLeavesList">
                        ${displayActiveLeaves()}
                    </div>
                </div>
            `;
            
            document.getElementById('leaveForm').addEventListener('submit', recordLeave);
        }

        function recordLeave(e) {
            e.preventDefault();
            
            const employeeName = document.getElementById('leaveEmployee').value;
            const stationName = document.getElementById('leaveStation').value;
            const type = document.getElementById('leaveType').value;
            const start = document.getElementById('leaveStart').value;
            const end = document.getElementById('leaveEnd').value;
            const notes = document.getElementById('leaveNotes').value;
            
            if (!employeeName || !stationName || !type || !start || !end) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (new Date(start) > new Date(end)) {
                showTemporaryMessage('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('leaveSubmitText');
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const newLeave = {
                employeeName,
                stationName,
                supervisorId: currentSupervisor.id,
                supervisorName: currentSupervisor.employeeName,
                type,
                start,
                end,
                notes: notes || '',
                timestamp: new Date().toISOString()
            };
            
            addData('leaves', newLeave)
                .then(() => {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('leaveForm').reset();
                    document.getElementById('leaveStart').value = getTodayDate();
                    document.getElementById('leaveEnd').value = getTodayDate();
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©';
                    }, 2000);
                    
                    document.getElementById('activeLeavesList').innerHTML = displayActiveLeaves();
                    showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                })
                .catch(error => {
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                    console.error(error);
                    showTemporaryMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
                });
        }

        function displayActiveLeaves() {
            const today = getTodayDate();
            const activeLeaves = leaves
                .filter(l => l.end >= today && l.supervisorId === currentSupervisor.id)
                .sort((a, b) => new Date(a.start) - new Date(b.start));
            
            if (activeLeaves.length === 0) {
                return '<div class="empty-state"><i class="fas fa-calendar-check"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª Ù†Ø´Ø·Ø©</div>';
            }
            
            let html = '';
            activeLeaves.forEach(leave => {
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${leave.employeeName}</div>
                            <div class="item-subtitle">
                                <span class="station-badge">${leave.stationName}</span>
                                <span>${leave.type}</span>
                            </div>
                            <div class="item-subtitle">
                                <i class="fas fa-calendar"></i> Ù…Ù† ${leave.start} Ø¥Ù„Ù‰ ${leave.end}
                            </div>
                        </div>
                    </div>
                `;
            });
            return html;
        }

        // ==================== ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ ====================
        function showFaultsPage() {
            const today = getTodayDate();
            
            mainContent.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-exclamation-triangle"></i> ØªØ³Ø¬ÙŠÙ„ Ø¹Ø·Ù„ Ø¬Ø¯ÙŠØ¯
                    </div>
                    <div class="card-body">
                        <div class="whatsapp-badge">
                            <i class="fab fa-whatsapp"></i>
                            Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ±ÙŠ Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… (${MANAGER_DISPLAY_PHONE})
                        </div>
                        
                        <form id="faultForm">
                            <div class="form-group">
                                <label><i class="fas fa-building"></i> Ø§Ù„Ù…Ø­Ø·Ø©</label>
                                <select id="faultStation" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø©</option>
                                    ${getStationsOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø·Ù„</label>
                                <input type="text" id="faultTitle" required placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø·Ù„">
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-align-left"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø·Ù„</label>
                                <textarea id="faultDescription" rows="4" required placeholder="Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø·Ù„"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø·Ù„</label>
                                <input type="date" id="faultDate" value="${today}" min="${today}" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tag"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø·Ù„</label>
                                <select id="faultStatus" required>
                                    <option value="pending">â³ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</option>
                                    <option value="in-progress">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­</option>
                                    <option value="fixed">âœ… ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn-warning">
                                <span id="faultSubmitText"><i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø·Ù„</span>
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list"></i> Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="form-group">
                                <label><i class="fas fa-filter"></i> ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <select id="filterFaultStatus">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                                    <option value="pending">â³ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</option>
                                    <option value="in-progress">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­</option>
                                    <option value="fixed">âœ… ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</option>
                                </select>
                            </div>
                        </div>
                        <div id="faultsList">
                            ${displayMyFaults()}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('faultForm').addEventListener('submit', recordFault);
            document.getElementById('filterFaultStatus').addEventListener('change', function() {
                document.getElementById('faultsList').innerHTML = displayMyFaults(this.value);
            });
        }

        function recordFault(e) {
            e.preventDefault();
            
            const stationName = document.getElementById('faultStation').value;
            const title = document.getElementById('faultTitle').value;
            const description = document.getElementById('faultDescription').value;
            const date = document.getElementById('faultDate').value;
            const status = document.getElementById('faultStatus').value;
            
            if (!stationName || !title || !description || !date || !status) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('faultSubmitText');
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const newFault = {
                stationName,
                supervisorId: currentSupervisor.id,
                supervisorName: currentSupervisor.employeeName,
                title,
                description,
                date,
                status,
                timestamp: new Date().toISOString()
            };
            
            addData('faults', newFault)
                .then(() => {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…
                    const notificationSent = sendFaultNotificationToManager(newFault);
                    
                    if (notificationSent) {
                        showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø·Ù„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…', 'success');
                    } else {
                        showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø·Ù„ ÙˆÙ„ÙƒÙ† ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'warning');
                    }
                    
                    document.getElementById('faultForm').reset();
                    document.getElementById('faultDate').value = getTodayDate();
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø·Ù„';
                    }, 3000);
                    
                    const filterStatus = document.getElementById('filterFaultStatus').value;
                    document.getElementById('faultsList').innerHTML = displayMyFaults(filterStatus);
                })
                .catch(error => {
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                    console.error(error);
                    showTemporaryMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
                });
        }

        function displayMyFaults(statusFilter = '') {
            let filtered = faults
                .filter(f => f.supervisorId === currentSupervisor.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (statusFilter) {
                filtered = filtered.filter(f => f.status === statusFilter);
            }
            
            if (filtered.length === 0) {
                return '<div class="empty-state"><i class="fas fa-tools"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ø·Ø§Ù„ Ù…Ø³Ø¬Ù„Ø©</div>';
            }
            
            let html = '';
            filtered.forEach(fault => {
                const statusClass = fault.status === 'fixed' ? 'status-present' :
                                   fault.status === 'in-progress' ? 'status-leave' : 'status-absent';
                const statusText = fault.status === 'fixed' ? 'âœ… ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­' :
                                  fault.status === 'in-progress' ? 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­' : 'â³ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­';
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${fault.title}</div>
                            <div class="item-subtitle">
                                <span class="station-badge">${fault.stationName}</span>
                                <span class="${statusClass}">${statusText}</span>
                            </div>
                            <div class="item-subtitle">
                                <i class="fas fa-calendar"></i> ${fault.date}
                            </div>
                            <div class="item-subtitle">
                                ${fault.description.substring(0, 60)}${fault.description.length > 60 ? '...' : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            return html;
        }

        // ==================== ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ù ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª ====================
        function showFinancialPage() {
            const today = getTodayDate();
            
            mainContent.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-hand-holding-usd"></i> ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ù…Ø§Ù„ÙŠØ©
                    </div>
                    <div class="card-body">
                        <form id="financialForm">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                <select id="financialEmployee" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù</option>
                                    ${getEmployeesOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-building"></i> Ø§Ù„Ù…Ø­Ø·Ø©</label>
                                <select id="financialStation" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø©</option>
                                    ${getStationsOptions()}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tag"></i> Ø§Ù„Ù†ÙˆØ¹</label>
                                <select id="financialType" required>
                                    <option value="Ø³Ù„ÙØ©">ğŸ’° Ø³Ù„ÙØ©</option>
                                    <option value="Ù…ÙƒØ§ÙØ£Ø©">ğŸ Ù…ÙƒØ§ÙØ£Ø©</option>
                                    <option value="Ø®ØµÙ…">ğŸ“‰ Ø®ØµÙ…</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ)</label>
                                <input type="number" id="financialAmount" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" min="1">
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="financialDate" value="${today}" min="${today}" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                <textarea id="financialNotes" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                            </div>
                            
                            <button type="submit" class="btn-success">
                                <span id="financialSubmitText"><i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©</span>
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-history"></i> Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="form-group">
                                <label><i class="fas fa-filter"></i> ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" id="filterFinancialDate" value="${today}" min="${today}">
                            </div>
                        </div>
                        <div id="financialList">
                            ${displayMyFinancials(today)}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('financialForm').addEventListener('submit', recordFinancial);
            document.getElementById('filterFinancialDate').addEventListener('change', function() {
                document.getElementById('financialList').innerHTML = displayMyFinancials(this.value);
            });
        }

        function recordFinancial(e) {
            e.preventDefault();
            
            const employeeName = document.getElementById('financialEmployee').value;
            const stationName = document.getElementById('financialStation').value;
            const type = document.getElementById('financialType').value;
            const amount = parseInt(document.getElementById('financialAmount').value);
            const date = document.getElementById('financialDate').value;
            const notes = document.getElementById('financialNotes').value;
            
            if (!employeeName || !stationName || !type || !amount || !date) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (amount <= 0) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('financialSubmitText');
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const newFinancial = {
                employeeName,
                stationName,
                supervisorId: currentSupervisor.id,
                supervisorName: currentSupervisor.employeeName,
                type,
                amount,
                date,
                notes: notes || '',
                timestamp: new Date().toISOString()
            };
            
            addData('financials', newFinancial)
                .then(() => {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('financialForm').reset();
                    document.getElementById('financialDate').value = getTodayDate();
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©';
                    }, 2000);
                    
                    const filterDate = document.getElementById('filterFinancialDate').value;
                    document.getElementById('financialList').innerHTML = displayMyFinancials(filterDate);
                    showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                })
                .catch(error => {
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                    console.error(error);
                    showTemporaryMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
                });
        }

        function displayMyFinancials(date) {
            const myFinancials = financials
                .filter(f => f.supervisorId === currentSupervisor.id && f.date === date)
                .sort((a, b) => a.employeeName.localeCompare(b.employeeName));
            
            if (myFinancials.length === 0) {
                return '<div class="empty-state"><i class="fas fa-coins"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø§Ù„ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</div>';
            }
            
            let html = '';
            myFinancials.forEach(financial => {
                const amountClass = financial.type === 'Ù…ÙƒØ§ÙØ£Ø©' ? 'status-present' :
                                   financial.type === 'Ø³Ù„ÙØ©' ? 'status-absent' : 'status-leave';
                const amountIcon = financial.type === 'Ù…ÙƒØ§ÙØ£Ø©' ? 'ğŸ' :
                                  financial.type === 'Ø³Ù„ÙØ©' ? 'ğŸ’°' : 'ğŸ“‰';
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${financial.employeeName}</div>
                            <div class="item-subtitle">
                                <span class="station-badge">${financial.stationName}</span>
                                <span>${financial.type}</span>
                            </div>
                        </div>
                        <div class="${amountClass}">${amountIcon} ${financial.amount} Ø¬.Ù…</div>
                    </div>
                `;
            });
            return html;
        }

        // ==================== ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‡Ø¯Ø© (Ù…Ø¹Ø¯Ù„Ø© - Ø¨Ø¯ÙˆÙ† Ø¯ÙŠÙˆÙ†) ====================
        function showCashPage() {
            const today = getTodayDate();
            const balance = calculateCashBalance();
            const balanceClass = balance < 0 ? 'negative' : '';
            
            mainContent.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-wallet"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‡Ø¯Ø©
                    </div>
                    <div class="card-body">
                        <div class="cash-summary">
                            <div class="cash-summary-item">
                                <span class="cash-summary-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                                <span class="cash-summary-value ${balanceClass}">${balance} Ø¬.Ù…</span>
                            </div>
                            <div class="cash-summary-item">
                                <span class="cash-summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª:</span>
                                <span class="cash-summary-value">${calculateTotalDeposits()} Ø¬.Ù…</span>
                            </div>
                            <div class="cash-summary-item">
                                <span class="cash-summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</span>
                                <span class="cash-summary-value">${calculateTotalWithdrawals()} Ø¬.Ù…</span>
                            </div>
                        </div>
                        
                        <div class="cash-tabs">
                            <div class="cash-tab active" data-tab="deposit">Ø¥ÙŠØ¯Ø§Ø¹</div>
                            <div class="cash-tab" data-tab="withdrawal">ØµØ±Ù</div>
                        </div>
                        
                        <div id="deposit" class="cash-tab-content active">
                            <form id="cashDepositForm">
                                <div class="form-group">
                                    <label><i class="fas fa-building"></i> Ø§Ù„Ù…Ø­Ø·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <select id="cashStation">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
                                        ${getStationsOptions()}
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ)</label>
                                    <input type="number" id="cashAmount" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" min="1">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" id="cashDate" value="${today}" min="${today}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-align-left"></i> Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</label>
                                    <input type="text" id="cashDepositReason" required placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                    <textarea id="cashNotes" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                                </div>
                                
                                <button type="submit" class="btn-cash">
                                    <span id="cashDepositSubmitText"><i class="fas fa-plus-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ø¥ÙŠØ¯Ø§Ø¹</span>
                                </button>
                            </form>
                        </div>
                        
                        <div id="withdrawal" class="cash-tab-content">
                            <form id="cashWithdrawalForm">
                                <div class="form-group">
                                    <label><i class="fas fa-building"></i> Ø§Ù„Ù…Ø­Ø·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <select id="cashWithdrawalStation">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
                                        ${getStationsOptions()}
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ)</label>
                                    <input type="number" id="cashWithdrawalAmount" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" min="1">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" id="cashWithdrawalDate" value="${today}" min="${today}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-align-left"></i> Ø³Ø¨Ø¨ Ø§Ù„ØµØ±Ù</label>
                                    <input type="text" id="cashWithdrawalReason" required placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„ØµØ±Ù">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-user"></i> Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                                    <input type="text" id="cashRecipient" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                    <textarea id="cashWithdrawalNotes" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                                </div>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØµØ±Ù Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ - Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø§Ù„Ø³Ø§Ù„Ø¨
                                </div>
                                
                                <button type="submit" class="btn-warning">
                                    <span id="cashWithdrawalSubmitText"><i class="fas fa-minus-circle"></i> ØªØ³Ø¬ÙŠÙ„ ØµØ±Ù</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø©
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="filter-with-button">
                                <div class="form-group">
                                    <label><i class="fas fa-filter"></i> ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" id="filterCashDate" value="${today}" min="${today}">
                                </div>
                                <button class="btn-secondary" id="filterCashBtn">
                                    <i class="fas fa-search"></i> Ø¨Ø­Ø«
                                </button>
                            </div>
                            <div class="form-group" style="margin-top: 10px;">
                                <label><i class="fas fa-tag"></i> Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©</label>
                                <select id="filterCashType">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª</option>
                                    <option value="Ø¥ÙŠØ¯Ø§Ø¹">Ø¥ÙŠØ¯Ø§Ø¹</option>
                                    <option value="ØµØ±Ù">ØµØ±Ù</option>
                                </select>
                            </div>
                        </div>
                        <div id="cashTransactionsList">
                            ${displayCashTransactions(today)}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('cashDepositForm').addEventListener('submit', recordCashDeposit);
            document.getElementById('cashWithdrawalForm').addEventListener('submit', recordCashWithdrawal);
            document.getElementById('filterCashBtn').addEventListener('click', function() {
                const filterDate = document.getElementById('filterCashDate').value;
                const filterType = document.getElementById('filterCashType').value;
                document.getElementById('cashTransactionsList').innerHTML = displayCashTransactions(filterDate, filterType);
            });
            document.getElementById('filterCashType').addEventListener('change', function() {
                const filterDate = document.getElementById('filterCashDate').value;
                const filterType = this.value;
                document.getElementById('cashTransactionsList').innerHTML = displayCashTransactions(filterDate, filterType);
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.cash-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.cash-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.cash-tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø¥ÙŠØ¯Ø§Ø¹
        function recordCashDeposit(e) {
            e.preventDefault();
            
            const stationName = document.getElementById('cashStation').value;
            const amount = parseInt(document.getElementById('cashAmount').value);
            const date = document.getElementById('cashDate').value;
            const reason = document.getElementById('cashDepositReason').value;
            const notes = document.getElementById('cashNotes').value;
            
            if (!amount || amount <= 0) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            if (!reason) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('cashDepositSubmitText');
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const newTransaction = {
                type: 'Ø¥ÙŠØ¯Ø§Ø¹',
                stationName: stationName || '',
                supervisorId: currentSupervisor.id,
                supervisorName: currentSupervisor.employeeName,
                amount,
                date,
                reason,
                notes: notes || '',
                timestamp: new Date().toISOString()
            };
            
            addData('cashTransactions', newTransaction)
                .then(() => {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('cashDepositForm').reset();
                    document.getElementById('cashDate').value = getTodayDate();
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ø¥ÙŠØ¯Ø§Ø¹';
                    }, 2000);
                    
                    const filterDate = document.getElementById('filterCashDate').value;
                    const filterType = document.getElementById('filterCashType').value;
                    document.getElementById('cashTransactionsList').innerHTML = displayCashTransactions(filterDate, filterType);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                    if (document.querySelector('.cash-summary')) {
                        showCashPage();
                    }
                    
                    showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                })
                .catch(error => {
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                    console.error(error);
                    showTemporaryMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
                });
        }

        // ØªØ³Ø¬ÙŠÙ„ ØµØ±Ù (ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø³Ø­Ø¨ Ø­ØªÙ‰ Ù…Ø¹ Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ)
        function recordCashWithdrawal(e) {
            e.preventDefault();
            
            const stationName = document.getElementById('cashWithdrawalStation').value;
            const amount = parseInt(document.getElementById('cashWithdrawalAmount').value);
            const date = document.getElementById('cashWithdrawalDate').value;
            const reason = document.getElementById('cashWithdrawalReason').value;
            const recipient = document.getElementById('cashRecipient').value;
            const notes = document.getElementById('cashWithdrawalNotes').value;
            
            if (!amount || amount <= 0) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            if (!reason) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„ØµØ±Ù', 'error');
                return;
            }
            
            if (!recipient) {
                showTemporaryMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('cashWithdrawalSubmitText');
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const newTransaction = {
                type: 'ØµØ±Ù',
                stationName: stationName || '',
                supervisorId: currentSupervisor.id,
                supervisorName: currentSupervisor.employeeName,
                amount,
                date,
                reason,
                recipient,
                notes: notes || '',
                timestamp: new Date().toISOString()
            };
            
            addData('cashTransactions', newTransaction)
                .then(() => {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('cashWithdrawalForm').reset();
                    document.getElementById('cashWithdrawalDate').value = getTodayDate();
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = '<i class="fas fa-minus-circle"></i> ØªØ³Ø¬ÙŠÙ„ ØµØ±Ù';
                    }, 2000);
                    
                    const filterDate = document.getElementById('filterCashDate').value;
                    const filterType = document.getElementById('filterCashType').value;
                    document.getElementById('cashTransactionsList').innerHTML = displayCashTransactions(filterDate, filterType);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                    if (document.querySelector('.cash-summary')) {
                        showCashPage();
                    }
                    
                    // ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ Ø£ØµØ¨Ø­ Ø§Ù„Ø±ØµÙŠØ¯ Ø³Ø§Ù„Ø¨Ø§Ù‹
                    const newBalance = calculateCashBalance() - amount;
                    if (newBalance < 0) {
                        showTemporaryMessage('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„Ø±ØµÙŠØ¯ Ø£ØµØ¨Ø­ Ø³Ø§Ù„Ø¨Ø§Ù‹', 'warning');
                    } else {
                        showTemporaryMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    }
                })
                .catch(error => {
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£';
                    console.error(error);
                    showTemporaryMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
                });
        }

        // Ø¹Ø±Ø¶ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø©
        function displayCashTransactions(dateFilter = '', typeFilter = '') {
            let filtered = cashTransactions
                .filter(c => c.supervisorId === currentSupervisor.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (dateFilter) {
                filtered = filtered.filter(c => c.date === dateFilter);
            }
            
            if (typeFilter) {
                filtered = filtered.filter(c => c.type === typeFilter);
            }
            
            if (filtered.length === 0) {
                return '<div class="empty-state"><i class="fas fa-coins"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ø¹Ù‡Ø¯Ø©</div>';
            }
            
            let html = '';
            filtered.forEach(transaction => {
                const amountClass = transaction.type === 'Ø¥ÙŠØ¯Ø§Ø¹' ? 'cash-positive' : 'cash-negative';
                const amountSign = transaction.type === 'Ø¥ÙŠØ¯Ø§Ø¹' ? '+' : '-';
                
                let details = '';
                if (transaction.type === 'Ø¥ÙŠØ¯Ø§Ø¹') {
                    details = `Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹: ${transaction.reason}`;
                } else {
                    details = `Ø³Ø¨Ø¨ Ø§Ù„ØµØ±Ù: ${transaction.reason} - Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${transaction.recipient}`;
                }
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${details}</div>
                            <div class="item-subtitle">
                                <span>${transaction.date}</span>
                                <span>${transaction.type}</span>
                                ${transaction.stationName ? `<span class="station-badge">${transaction.stationName}</span>` : ''}
                            </div>
                            ${transaction.notes ? `<div class="item-subtitle">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${transaction.notes}</div>` : ''}
                        </div>
                        <div class="${amountClass}">${amountSign} ${transaction.amount} Ø¬.Ù…</div>
                    </div>
                `;
            });
            return html;
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…Ø¤Ù‚ØªØ©
        function showTemporaryMessage(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '60px';
            alertDiv.style.right = '15px';
            alertDiv.style.left = '15px';
            alertDiv.style.maxWidth = '400px';
            alertDiv.style.margin = '0 auto';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.boxShadow = '0 8px 20px rgba(0,0,0,0.15)';
            
            let icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            else if (type === 'warning') icon = 'exclamation-triangle';
            
            alertDiv.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }, 3000);
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± fadeOut
        const fadeStyle = document.createElement('style');
        fadeStyle.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-10px); }
            }
        `;
        document.head.appendChild(fadeStyle);
    </script>
</body>
</html>
